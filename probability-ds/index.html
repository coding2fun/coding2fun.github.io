<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Probabilistic Data Structures - Coding is Fun</title><meta name="Description" content="Introduction to Probabilistic Data Structures"><meta property="og:title" content="Probabilistic Data Structures" />
<meta property="og:description" content="Introduction to Probabilistic Data Structures" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://coding2fun.github.io/probability-ds/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-06-05T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Probabilistic Data Structures"/>
<meta name="twitter:description" content="Introduction to Probabilistic Data Structures"/>
<meta name="application-name" content="Coding2fun">
<meta name="apple-mobile-web-app-title" content="Coding2fun"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://coding2fun.github.io/probability-ds/" /><link rel="prev" href="https://coding2fun.github.io/micronaut_aws_lambda/" /><link rel="next" href="https://coding2fun.github.io/kotlin_coroutines-1/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Probabilistic Data Structures",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/coding2fun.github.io\/probability-ds\/"
        },"genre": "posts","keywords": "bloom-filters, go, golang, probabilistic-data-structures","wordcount":  1004 ,
        "url": "https:\/\/coding2fun.github.io\/probability-ds\/","datePublished": "2019-06-05T00:00:00+00:00","dateModified": "2019-06-05T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Kishore Karunakaran"
            },"description": "Introduction to Probabilistic Data Structures"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Coding is Fun"><span class="header-title-pre"><i class='far fa-grin-alt'></i></span>Coding is Fun</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Coding is Fun"><span class="header-title-pre"><i class='far fa-grin-alt'></i></span>Coding is Fun</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Probabilistic Data Structures</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://coding2fun.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kishore Karunakaran</a></span>&nbsp;<span class="post-category">included in <a href="/categories/go/"><i class="far fa-folder fa-fw"></i>go</a>&nbsp;<a href="/categories/bloom-filters/"><i class="far fa-folder fa-fw"></i>bloom-filters</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2019-06-05">2019-06-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1004 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#bloom-filter">Bloom Filter</a></li>
        <li><a href="#code">Code</a></li>
        <li><a href="#use-cases">Use Cases</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/email.png"
        data-srcset="/images/email.png, /images/email.png 1.5x, /images/email.png 2x"
        data-sizes="auto"
        alt="/images/email.png"
        title="image alt text" /></p>
<p><br /></p>
<p>Suppose let’s say you are signing up for the new Email id. When you enter a new mail id, respective mail service will check whether the given mail id already exists.</p>
<p>So how can we build such a kind of systems ? Think for a minute before continue reading</p>
<ul>
<li>Keep all email id’s in memory i.e. Cache, It’s not practical to keep all email id’s in memory.</li>
<li>Store it in database/disk and check whether the given email id exist by reading or querying from db/disk. This will be more time consuming.</li>
</ul>
<p>Let’s see how we can use probability data structures to build these kind of systems.</p>
<p><br /></p>
<h3 id="bloom-filter">Bloom Filter</h3>
<p>It is a space-efficient probabilistic data structure for representing a set D = {x1, x2,…, xn} of n elements that supports only two operations.</p>
<ul>
<li>Adding an elements to the set {Add}</li>
<li>Checking whether the element exist in the set or not {Contains}</li>
</ul>
<p>When bloom filter checks whether an item exist in the set, it can give either it’s present or not present. If the bloom filter gives the result as not present, it’s 100% sure the item does not exist in the set but it is not same for when the result is present, because when the result is present, it’s only 90% sure that the item exist.</p>
<ul>
<li><strong>Contains(item) =&gt; “May be in the set” or “Definitely not in set”</strong></li>
<li><strong>Definitely not in set is 100%</strong></li>
</ul>
<p>Hashing plays the central role in probabilistic data structures as they use it for randomization and compact representation of the data.</p>
<p>So, what is hashing ?</p>
<p><strong>Hashing is a function which takes an inputs of varying size and generates fixed size value which is called hash value.</strong></p>
<p>There are many hash functions available, the choice of hash function are important to avoid bias. When a hash function compresses the input, it may generate same hash value for two or more different inputs which is unavoidable and this is called hash collision. Probabilistic data structures uses non Cryptographic hash functions. The reason for the use of non-cryptographic hash function is that they’re significantly faster than cryptographic hash functions.</p>
<p>The bloom filter is represented by a bit array and can be described by its length <strong>L</strong> and number of different hash functions <strong>H</strong>. Each hash function should be independent and uniformly distributed. In this way, we randomize the hash values uniformly (you can think of it as using hash functions as some kind of random-number generator) in the filter and decrease the probability of hash collisions. Such an approach drastically reduces the storage space and, regardless of the number of elements in the data structure and their size, requires a constant number of bits by reserving a few bits per element.</p>
<p>In the beginning the bit array of length <strong>L</strong> all bits are equal to zero. i.e. Set is empty.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bit_array1.png"
        data-srcset="/images/bit_array1.png, /images/bit_array1.png 1.5x, /images/bit_array1.png 2x"
        data-sizes="auto"
        alt="/images/bit_array1.png"
        title="image alt text" /></p>
<p>To insert an element <strong>x</strong> into the filter, for every hash function <strong>H(i)</strong> we compute its value <strong>j</strong> = <strong>H(i){x}</strong> on the element <strong>x</strong> and set the corresponding bit <strong>j</strong> in the filter to one. Note, it is possible that some bits can be set multiple times due to hash collisions.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bit_array2.png"
        data-srcset="/images/bit_array2.png, /images/bit_array2.png 1.5x, /images/bit_array2.png 2x"
        data-sizes="auto"
        alt="/images/bit_array2.png"
        title="image alt text" /></p>
<p>In the above diagram, I’ve used only two hash function, but in practice, we will use more hash functions. It is possible that different elements can share corresponding bits(both inputs shared 5th index in the above pic)</p>
<p>When we check for the element <strong>x</strong> in the filter, we compute all hash functions <strong>H(i){x}</strong> for i=1,2,…n and check bits in the corresponding positions. If all bits are set to one, then the element <strong>x</strong> may exist in the filter. Otherwise, the element <strong>x</strong> is definitely not in the filter.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bit_array3.png"
        data-srcset="/images/bit_array3.png, /images/bit_array3.png 1.5x, /images/bit_array3.png 2x"
        data-sizes="auto"
        alt="/images/bit_array3.png"
        title="image alt text" /></p>
<p>In the above case, for the input “justincampell” we compute all hash functions in this case we have two hash functions and that gives us two indices(2, 8). Thus, checking the bits 2 and 8, we see that bit 2 isn’t set, therefore the item “justincampell” is <strong><em>definitely not in the set</em></strong> and we don’t even need to check bit 8.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/bit_array4.png"
        data-srcset="/images/bit_array4.png, /images/bit_array4.png 1.5x, /images/bit_array4.png 2x"
        data-sizes="auto"
        alt="/images/bit_array4.png"
        title="image alt text" /></p>
<p><br /></p>
<h3 id="code">Code</h3>
<ul>
<li>Let’s define bloom filter struct in go</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// BloomFilter struct definition
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">BloomFilter</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">bitArray</span>      <span class="p">[]</span><span class="kt">bool</span>        <span class="c1">// BloomFilter bit array
</span><span class="c1"></span>    <span class="nx">bitArraySize</span>  <span class="kt">int</span>           <span class="c1">// Number of bits to use to persist elements
</span><span class="c1"></span>    <span class="nx">maxSize</span>       <span class="kt">int</span>           <span class="c1">// Maximum Size of the bloom filter
</span><span class="c1"></span>    <span class="nx">hashFunctions</span> <span class="p">[]</span><span class="nx">hash</span><span class="p">.</span><span class="nx">Hash64</span> <span class="c1">// List of hash functions
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Adding an element to the set</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Add adding an elements to the filter
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">bl</span> <span class="o">*</span><span class="nx">BloomFilter</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">item</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">indices</span> <span class="o">:=</span> <span class="nx">bl</span><span class="p">.</span><span class="nf">fetchIndices</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">index</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">indices</span> <span class="p">{</span>
        <span class="nx">bl</span><span class="p">.</span><span class="nx">bitArray</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Checking whether the element exist in the set or not</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Contains checking whether the element exist in the set or not
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">bl</span> <span class="o">*</span><span class="nx">BloomFilter</span><span class="p">)</span> <span class="nf">Contains</span><span class="p">(</span><span class="nx">item</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">indices</span> <span class="o">:=</span> <span class="nx">bl</span><span class="p">.</span><span class="nf">fetchIndices</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">index</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">indices</span> <span class="p">{</span>
        <span class="nx">bitValue</span> <span class="o">:=</span> <span class="nx">bl</span><span class="p">.</span><span class="nx">bitArray</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">bitValue</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Complete code in <a href="https://gist.github.com/khekrn/ccee44c93e614593efc19a5b46ef95d0" target="_blank" rel="noopener noreffer">github</a></p>
<p><br /></p>
<h3 id="use-cases">Use Cases</h3>
<ul>
<li>Google Bigtable, Apache HBase and Apache Cassandra, Postgresql and many more databases use Probabilistic data structures to reduce the disk lookups for non-existent rows or columns. Avoiding costly disk lookups considerably increases the performance of a database query operation.</li>
<li>Medium uses Probabilistic data structures to check if an article has already been recommended to an user.</li>
<li>Ethereum uses Probabilistic data structures for quickly finding logs on the Ethereum blockchain.</li>
<li>URL Shortners</li>
<li>The Google Chrome web browser used to use a Probabilistic data structure to identify malicious URLs.</li>
<li>For realtime monitoring dashboards and many more.</li>
</ul>
<p><br /></p>
<h3 id="conclusion">Conclusion</h3>
<ul>
<li>Probabilistic data structure is a data structure which always provides approximated answers, but with reliable ways to estimate possible errors.</li>
<li>False positive is possible but false negatives are not. False Positive, Item does not exist but bloom filter says it does. False Negative, Item do exist but bloom filter says it does not.</li>
</ul>
<p><br /></p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/658439/how-many-hash-functions-does-my-bloom-filter-need" target="_blank" rel="noopener noreffer">How many optimal hash functions required</a></li>
<li><a href="https://www.youtube.com/watch?v=-tT40zeWgXM&amp;t=294s" target="_blank" rel="noopener noreffer">Probabilistic Data Structures</a></li>
<li><a href="https://www.gakhov.com/" target="_blank" rel="noopener noreffer">Andrii Gakhov - Probabilistic Data Structures</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2019-06-05</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://coding2fun.github.io/probability-ds/" data-title="Probabilistic Data Structures" data-via="itzkhekrn" data-hashtags="bloom-filters,go,golang,probabilistic-data-structures"><i class="fab fa-twitter fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/bloom-filters/">bloom-filters</a>,&nbsp;<a href="/tags/go/">go</a>,&nbsp;<a href="/tags/golang/">golang</a>,&nbsp;<a href="/tags/probabilistic-data-structures/">probabilistic-data-structures</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/micronaut_aws_lambda/" class="prev" rel="prev" title="Micronaut and AWS Lambda"><i class="fas fa-angle-left fa-fw"></i>Micronaut and AWS Lambda</a>
            <a href="/kotlin_coroutines-1/" class="next" rel="next" title="Writing non blocking async processing using Kotlin Coroutines in JVM">Writing non blocking async processing using Kotlin Coroutines in JVM<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
